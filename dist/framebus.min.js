"use strict";!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(n):"function"==typeof define&&define.amd?define([],function(){return r(n)}):n.framebus=r(n)}(this,function(n){function r(n){return null==n?!1:null==n.Window?!1:n.constructor!==n.Window?!1:(m.push(n),!0)}function e(n){var r,e={};for(r in b)b.hasOwnProperty(r)&&(e[r]=b[r]);return e._origin=n||"*",e}function t(n){var r,e,t=i(this);return s(n)?!1:s(t)?!1:(e=Array.prototype.slice.call(arguments,1),r=a(n,e,t),r===!1?!1:(x(y.top,r,t),!0))}function o(n,r){var e=i(this);return v(n,r,e)?!1:(w[e]=w[e]||{},w[e][n]=w[e][n]||[],w[e][n].push(r),!0)}function u(n,r){var e,t,o=i(this);if(v(n,r,o))return!1;if(t=w[o]&&w[o][n],!t)return!1;for(e=0;e<t.length;e++)if(t[e]===r)return t.splice(e,1),!0;return!1}function i(n){return n&&n._origin||"*"}function s(n){return"string"!=typeof n}function a(n,r,e){var t=!1,o={event:n,origin:e},u=r[r.length-1];"function"==typeof u&&(o.reply=h(u,e),r=r.slice(0,-1)),o.args=r;try{t=E+JSON.stringify(o)}catch(i){throw new Error("Could not stringify event: "+i.message)}return t}function c(n){var r,e,t,o;if(n.data.slice(0,E.length)!==E)return!1;try{r=JSON.parse(n.data.slice(E.length))}catch(u){return!1}return null!=r.reply&&(e=n.origin,t=n.source,o=r.reply,r.reply=function(n){var r=a(o,[n],e);return r===!1?!1:(t.postMessage(r,e),void 0)},r.args.push(r.reply)),r}function f(r){y||(y=r||n,y.addEventListener?y.addEventListener("message",g,!1):y.attachEvent?y.attachEvent("onmessage",g):null===y.onmessage?y.onmessage=g:y=null)}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var r=16*Math.random()|0,e="x"===n?r:3&r|8;return e.toString(16)})}function g(n){var r;s(n.data)||(r=c(n),r&&(p("*",r.event,r.args,n),p(n.origin,r.event,r.args,n),d(n.data,r.origin,n.source)))}function p(n,r,e,t){var o;if(w[n]&&w[n][r])for(o=0;o<w[n][r].length;o++)w[n][r][o].apply(t,e)}function x(n,r,e){var t;try{n.postMessage(r,e)}catch(o){return}for(n.opener&&!n.opener.closed&&n.opener!==y&&x(n.opener.top,r,e),t=0;t<n.frames.length;t++)x(n.frames[t],r,e)}function d(n,r,e){var t,o;for(t=m.length-1;t>=0;t--)o=m[t],o.closed===!0?m=m.slice(t,1):e!==o&&x(o.top,n,r)}function h(n,r){function e(o,u){n(o,u),b.target(r).unsubscribe(t,e)}var t=l();return b.target(r).subscribe(t,e),t}function v(n,r,e){return s(n)?!0:"function"!=typeof r?!0:s(e)?!0:!1}var y,b,m=[],w={},E="/*framebus*/";return f(),b={target:e,include:r,publish:t,pub:t,trigger:t,emit:t,subscribe:o,sub:o,on:o,unsubscribe:u,unsub:u,off:u}});
"use strict";!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):n.framebus=t()}(this,function(){function n(n){null!=n&&null!=n.Window&&n.constructor===n.Window&&v.push(n)}function t(n){var t,e={};for(t in d)d.hasOwnProperty(t)&&(e[t]=d[t]);return e._origin=n||"*",e}function e(n){var t,e,r=this._origin||"*";return"string"!=typeof n?!1:"string"!=typeof r?!1:(e=Array.prototype.slice.call(arguments,1),t=o(n,e,r),t===!1?!1:(g(y.top,t,r),!0))}function r(n,t){var e=this._origin||"*";return x(n,t,e)?!1:(h[e]=h[e]||{},h[e][n]=h[e][n]||[],h[e][n].push(t),!0)}function i(n,t){var e,r,i=this._origin||"*";if(x(n,t,i))return!1;if(r=h[i]&&h[i][n],!r)return!1;for(e=0;e<r.length;e++)if(r[e]===t)return r.splice(e,1),!0;return!1}function o(n,t,e){var r=!1,i={event:n,origin:e},o=t[t.length-1];"function"==typeof o&&(i.reply=p(o,e),t=t.slice(0,-1)),i.args=t;try{r=b+JSON.stringify(i)}catch(u){throw new Error("Could not stringify event: "+u.message)}return r}function u(n){var t,e,r,i;if(n.data.slice(0,b.length)!==b)return!1;try{t=JSON.parse(n.data.slice(b.length))}catch(u){return!1}return null!=t.reply&&(e=n.origin,r=n.source,i=t.reply,t.reply=function(n){var t=o(i,[n],e);return t===!1?!1:(r.postMessage(t,e),void 0)},t.args.push(t.reply)),t}function s(n){y||(y=n||window,y.addEventListener?y.addEventListener("message",f,!1):y.attachEvent?y.attachEvent("onmessage",f):null===y.onmessage?y.onmessage=f:y=null)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=16*Math.random()|0,e="x"===n?t:3&t|8;return e.toString(16)})}function f(n){var t;"string"==typeof n.data&&(t=u(n),t&&(c("*",t.event,t.args,n),c(n.origin,t.event,t.args,n),l(n.data,t.origin)))}function c(n,t,e,r){var i;if(h[n]&&h[n][t])for(i=0;i<h[n][t].length;i++)h[n][t][i].apply(r,e)}function g(n,t,e){var r;for(n.postMessage(t,e),n.opener&&n.opener!==y&&g(n.opener.top,t,e),r=0;r<n.frames.length;r++)g(n.frames[r],t,e)}function l(n,t){var e,r;for(e=v.length-1;e>=0;e--)r=v[e],r.closed===!0?v=v.slice(e,1):g(r.top,n,t)}function p(n,t){function e(i,o){n(i,o),d.target(t).unsubscribe(r,e)}var r=a();return d.target(t).subscribe(r,e),r}function x(n,t,e){return"string"!=typeof n?!0:"function"!=typeof t?!0:"string"!=typeof e?!0:!1}var y,d,v=[],h={},b="/*framebus*/";return s(),d={target:t,include:n,publish:e,pub:e,trigger:e,emit:e,subscribe:r,sub:r,on:r,unsubscribe:i,unsub:i,off:i}});
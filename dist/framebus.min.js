"use strict";!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):n.framebus=t()}(this,function(){function n(n,t,e){var o;return e=e||"*","string"!=typeof n?!1:"string"!=typeof e?!1:(o=r(n,t,e),o===!1?!1:(s(p.top,o,e),!0))}function t(n,t,e){return e=e||"*",g(n,t,e)?!1:(l[e]=l[e]||{},l[e][n]=l[e][n]||[],l[e][n].push(t),!0)}function e(n,t,e){var r,o;if(e=e||"*",g(n,t,e))return!1;if(o=l[e]&&l[e][n],!o)return!1;for(r=0;r<o.length;r++)if(o[r]===t)return o.splice(r,1),!0;return!1}function r(n,t,e){var r=!1,o={event:n,origin:e};"function"==typeof t?o.reply=x(t,e):o.data=t;try{r=v+JSON.stringify(o)}catch(i){throw new Error("Could not stringify event: "+i.message)}return r}function o(n){var t,e,o;if(n.data.slice(0,v.length)!==v)return!1;try{t=JSON.parse(n.data.slice(v.length))}catch(i){return!1}return null!=t.reply&&(e=n.origin,o=n.source,t.data=function(n){var i=r(t.reply,n,e);return i===!1?!1:(o.postMessage(i,e),void 0)}),t}function i(n){p||(p=n,p.addEventListener?p.addEventListener("message",a,!1):p.attachEvent?p.attachEvent("onmessage",a):null===p.onmessage?p.onmessage=a:p=null)}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=16*Math.random()|0,e="x"===n?t:3&t|8;return e.toString(16)})}function a(n){var t;"string"==typeof n.data&&(t=o(n),t&&(f("*",t.event,t.data,n.origin),f(n.origin,t.event,t.data,n.origin),c(n.data,t.origin)))}function f(n,t,e,r){var o;if(l[n]&&l[n][t])for(o=0;o<l[n][t].length;o++)l[n][t][o](e,r)}function s(n,t,e){var r;for(n.postMessage(t,e),n.opener&&n.opener!==p&&s(n.opener.top,t,e),r=0;r<n.frames.length;r++)s(n.frames[r],t,e);c(t,e)}function c(n,t){var e,r;for(e=d.length-1;e>=0;e--)r=d[e],r.closed===!0?d=d.slice(e,1):s(r.top,n,t)}function x(n,r){function o(t,u){n(t,u),e(i,o,r)}var i=u();return t(i,o,r),i}function g(n,t,e){return"string"!=typeof n?!0:"function"!=typeof t?!0:"string"!=typeof e?!0:!1}var p,d=[],l={},v="/*framebus*/";return i(window),{publish:n,pub:n,trigger:n,emit:n,subscribe:t,sub:t,on:t,unsubscribe:e,unsub:e,off:e}});

"use strict";!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):n.framebus=e()}(this,function(){function n(n){return null==n?!1:null==n.Window?!1:n.constructor!==n.Window?!1:(b.push(n),!0)}function e(n){var e,r={};for(e in y)y.hasOwnProperty(e)&&(r[e]=y[e]);return r._origin=n||"*",r}function r(n){var e,r,t=o(this);return u(n)?!1:u(t)?!1:(r=Array.prototype.slice.call(arguments,1),e=s(n,r,t),e===!1?!1:(p(h.top,e,t),!0))}function t(n,e){var r=o(this);return v(n,e,r)?!1:(m[r]=m[r]||{},m[r][n]=m[r][n]||[],m[r][n].push(e),!0)}function i(n,e){var r,t,i=o(this);if(v(n,e,i))return!1;if(t=m[i]&&m[i][n],!t)return!1;for(r=0;r<t.length;r++)if(t[r]===e)return t.splice(r,1),!0;return!1}function o(n){return n&&n._origin||"*"}function u(n){return"string"!=typeof n}function s(n,e,r){var t=!1,i={event:n,origin:r},o=e[e.length-1];"function"==typeof o&&(i.reply=d(o,r),e=e.slice(0,-1)),i.args=e;try{t=w+JSON.stringify(i)}catch(u){throw new Error("Could not stringify event: "+u.message)}return t}function a(n){var e,r,t,i;if(n.data.slice(0,w.length)!==w)return!1;try{e=JSON.parse(n.data.slice(w.length))}catch(o){return!1}return null!=e.reply&&(r=n.origin,t=n.source,i=e.reply,e.reply=function(n){var e=s(i,[n],r);return e===!1?!1:(t.postMessage(e,r),void 0)},e.args.push(e.reply)),e}function f(n){h||(h=n||window,h.addEventListener?h.addEventListener("message",l,!1):h.attachEvent?h.attachEvent("onmessage",l):null===h.onmessage?h.onmessage=l:h=null)}function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=16*Math.random()|0,r="x"===n?e:3&e|8;return r.toString(16)})}function l(n){var e;u(n.data)||(e=a(n),e&&(g("*",e.event,e.args,n),g(n.origin,e.event,e.args,n),x(n.data,e.origin,n.source)))}function g(n,e,r,t){var i;if(m[n]&&m[n][e])for(i=0;i<m[n][e].length;i++)m[n][e][i].apply(t,r)}function p(n,e,r){var t;for(n.postMessage(e,r),n.opener&&n.opener!==h&&p(n.opener.top,e,r),t=0;t<n.frames.length;t++)p(n.frames[t],e,r)}function x(n,e,r){var t,i;for(t=b.length-1;t>=0;t--)i=b[t],i.closed===!0?b=b.slice(t,1):r!==i&&p(i.top,n,e)}function d(n,e){function r(i,o){n(i,o),y.target(e).unsubscribe(t,r)}var t=c();return y.target(e).subscribe(t,r),t}function v(n,e,r){return u(n)?!0:"function"!=typeof e?!0:u(r)?!0:!1}var h,y,b=[],m={},w="/*framebus*/";return f(),y={target:e,include:n,publish:r,pub:r,trigger:r,emit:r,subscribe:t,sub:t,on:t,unsubscribe:i,unsub:i,off:i}});
"use strict";!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):n.framebus=e()}(this,function(){function n(n){n instanceof Window&&v.push(n)}function e(n){var e,t={};for(e in d)d.hasOwnProperty(e)&&(t[e]=d[e]);return t._origin=n||"*",t}function t(n){var e,t,r=this._origin||"*";return"string"!=typeof n?!1:"string"!=typeof r?!1:(t=Array.prototype.slice.call(arguments,1),e=o(n,t,r),e===!1?!1:(g(y.top,e,r),!0))}function r(n,e){var t=this._origin||"*";return x(n,e,t)?!1:(h[t]=h[t]||{},h[t][n]=h[t][n]||[],h[t][n].push(e),!0)}function i(n,e){var t,r,i=this._origin||"*";if(x(n,e,i))return!1;if(r=h[i]&&h[i][n],!r)return!1;for(t=0;t<r.length;t++)if(r[t]===e)return r.splice(t,1),!0;return!1}function o(n,e,t){var r=!1,i={event:n,origin:t},o=e[e.length-1];"function"==typeof o&&(i.reply=l(o,t),e=e.slice(0,-1)),i.args=e;try{r=b+JSON.stringify(i)}catch(s){throw new Error("Could not stringify event: "+s.message)}return r}function s(n){var e,t,r,i;if(n.data.slice(0,b.length)!==b)return!1;try{e=JSON.parse(n.data.slice(b.length))}catch(s){return!1}return null!=e.reply&&(t=n.origin,r=n.source,i=e.reply,e.reply=function(n){var e=o(i,[n],t);return e===!1?!1:(r.postMessage(e,t),void 0)},e.args.push(e.reply)),e}function u(n){y||(y=n||window,y.addEventListener?y.addEventListener("message",f,!1):y.attachEvent?y.attachEvent("onmessage",f):null===y.onmessage?y.onmessage=f:y=null)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=16*Math.random()|0,t="x"===n?e:3&e|8;return t.toString(16)})}function f(n){var e;"string"==typeof n.data&&(e=s(n),e&&(c("*",e.event,e.args,n),c(n.origin,e.event,e.args,n),p(n.data,e.origin)))}function c(n,e,t,r){var i;if(h[n]&&h[n][e])for(i=0;i<h[n][e].length;i++)h[n][e][i].apply(r,t)}function g(n,e,t){var r;for(n.postMessage(e,t),n.opener&&n.opener!==y&&g(n.opener.top,e,t),r=0;r<n.frames.length;r++)g(n.frames[r],e,t);p(e,t)}function p(n,e){var t,r;for(t=v.length-1;t>=0;t--)r=v[t],r.closed===!0?v=v.slice(t,1):g(r.top,n,e)}function l(n,e){function t(i,o){n(i,o),d.target(e).unsubscribe(r,t)}var r=a();return d.target(e).subscribe(r,t),r}function x(n,e,t){return"string"!=typeof n?!0:"function"!=typeof e?!0:"string"!=typeof t?!0:!1}var y,d,v=[],h={},b="/*framebus*/";return u(),d={target:e,include:n,publish:t,pub:t,trigger:t,emit:t,subscribe:r,sub:r,on:r,unsubscribe:i,unsub:i,off:i}});
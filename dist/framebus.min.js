"use strict";!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):n.framebus=e()}(this,function(){function n(n){return null==n?!1:null==n.Window?!1:n.constructor!==n.Window?!1:(v.push(n),!0)}function e(n){var e,r={};for(e in d)d.hasOwnProperty(e)&&(r[e]=d[e]);return r._origin=n||"*",r}function r(n){var e,r,t=this._origin||"*";return"string"!=typeof n?!1:"string"!=typeof t?!1:(r=Array.prototype.slice.call(arguments,1),e=o(n,r,t),e===!1?!1:(g(y.top,e,t),!0))}function t(n,e){var r=this._origin||"*";return x(n,e,r)?!1:(h[r]=h[r]||{},h[r][n]=h[r][n]||[],h[r][n].push(e),!0)}function i(n,e){var r,t,i=this._origin||"*";if(x(n,e,i))return!1;if(t=h[i]&&h[i][n],!t)return!1;for(r=0;r<t.length;r++)if(t[r]===e)return t.splice(r,1),!0;return!1}function o(n,e,r){var t=!1,i={event:n,origin:r},o=e[e.length-1];"function"==typeof o&&(i.reply=p(o,r),e=e.slice(0,-1)),i.args=e;try{t=b+JSON.stringify(i)}catch(u){throw new Error("Could not stringify event: "+u.message)}return t}function u(n){var e,r,t,i;if(n.data.slice(0,b.length)!==b)return!1;try{e=JSON.parse(n.data.slice(b.length))}catch(u){return!1}return null!=e.reply&&(r=n.origin,t=n.source,i=e.reply,e.reply=function(n){var e=o(i,[n],r);return e===!1?!1:(t.postMessage(e,r),void 0)},e.args.push(e.reply)),e}function s(n){y||(y=n||window,y.addEventListener?y.addEventListener("message",f,!1):y.attachEvent?y.attachEvent("onmessage",f):null===y.onmessage?y.onmessage=f:y=null)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=16*Math.random()|0,r="x"===n?e:3&e|8;return r.toString(16)})}function f(n){var e;"string"==typeof n.data&&(e=u(n),e&&(c("*",e.event,e.args,n),c(n.origin,e.event,e.args,n),l(n.data,e.origin,n.source)))}function c(n,e,r,t){var i;if(h[n]&&h[n][e])for(i=0;i<h[n][e].length;i++)h[n][e][i].apply(t,r)}function g(n,e,r){var t;for(n.postMessage(e,r),n.opener&&n.opener!==y&&g(n.opener.top,e,r),t=0;t<n.frames.length;t++)g(n.frames[t],e,r)}function l(n,e,r){var t,i;for(t=v.length-1;t>=0;t--)i=v[t],i.closed===!0?v=v.slice(t,1):r!==i&&g(i.top,n,e)}function p(n,e){function r(i,o){n(i,o),d.target(e).unsubscribe(t,r)}var t=a();return d.target(e).subscribe(t,r),t}function x(n,e,r){return"string"!=typeof n?!0:"function"!=typeof e?!0:"string"!=typeof r?!0:!1}var y,d,v=[],h={},b="/*framebus*/";return s(),d={target:e,include:n,publish:r,pub:r,trigger:r,emit:r,subscribe:t,sub:t,on:t,unsubscribe:i,unsub:i,off:i}});
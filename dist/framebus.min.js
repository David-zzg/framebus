"use strict";!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):n.framebus=r()}(this,function(){function n(n){return null==n?!1:null==n.Window?!1:n.constructor!==n.Window?!1:(b.push(n),!0)}function r(n){var r,e={};for(r in y)y.hasOwnProperty(r)&&(e[r]=y[r]);return e._origin=n||"*",e}function e(n){var r,e,t=o(this);return u(n)?!1:u(t)?!1:(e=Array.prototype.slice.call(arguments,1),r=s(n,e,t),r===!1?!1:(p(v.top,r,t),!0))}function t(n,r){var e=o(this);return h(n,r,e)?!1:(m[e]=m[e]||{},m[e][n]=m[e][n]||[],m[e][n].push(r),!0)}function i(n,r){var e,t,i=o(this);if(h(n,r,i))return!1;if(t=m[i]&&m[i][n],!t)return!1;for(e=0;e<t.length;e++)if(t[e]===r)return t.splice(e,1),!0;return!1}function o(n){return n&&n._origin||"*"}function u(n){return"string"!=typeof n}function s(n,r,e){var t=!1,i={event:n,origin:e},o=r[r.length-1];"function"==typeof o&&(i.reply=d(o,e),r=r.slice(0,-1)),i.args=r;try{t=w+JSON.stringify(i)}catch(u){throw new Error("Could not stringify event: "+u.message)}return t}function a(n){var r,e,t,i;if(n.data.slice(0,w.length)!==w)return!1;try{r=JSON.parse(n.data.slice(w.length))}catch(o){return!1}return null!=r.reply&&(e=n.origin,t=n.source,i=r.reply,r.reply=function(n){var r=s(i,[n],e);return r===!1?!1:(t.postMessage(r,e),void 0)},r.args.push(r.reply)),r}function c(n){v||(v=n||window,v.addEventListener?v.addEventListener("message",l,!1):v.attachEvent?v.attachEvent("onmessage",l):null===v.onmessage?v.onmessage=l:v=null)}function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var r=16*Math.random()|0,e="x"===n?r:3&r|8;return e.toString(16)})}function l(n){var r;u(n.data)||(r=a(n),r&&(g("*",r.event,r.args,n),g(n.origin,r.event,r.args,n),x(n.data,r.origin,n.source)))}function g(n,r,e,t){var i;if(m[n]&&m[n][r])for(i=0;i<m[n][r].length;i++)m[n][r][i].apply(t,e)}function p(n,r,e){var t;try{n.postMessage(r,e)}catch(i){return}for(n.opener&&n.opener!==v&&p(n.opener.top,r,e),t=0;t<n.frames.length;t++)p(n.frames[t],r,e)}function x(n,r,e){var t,i;for(t=b.length-1;t>=0;t--)i=b[t],i.closed===!0?b=b.slice(t,1):e!==i&&p(i.top,n,r)}function d(n,r){function e(i,o){n(i,o),y.target(r).unsubscribe(t,e)}var t=f();return y.target(r).subscribe(t,e),t}function h(n,r,e){return u(n)?!0:"function"!=typeof r?!0:u(e)?!0:!1}var v,y,b=[],m={},w="/*framebus*/";return c(),y={target:r,include:n,publish:e,pub:e,trigger:e,emit:e,subscribe:t,sub:t,on:t,unsubscribe:i,unsub:i,off:i}});
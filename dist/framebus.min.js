"use strict";!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(n):"function"==typeof define&&define.amd?define([],function(){return r(n)}):n.framebus=r(n)}(this,function(n){function r(n){return null==n?!1:null==n.Window?!1:n.constructor!==n.Window?!1:(w.push(n),!0)}function e(n){var r,e={};for(r in m)m.hasOwnProperty(r)&&(e[r]=m[r]);return e._origin=n||"*",e}function t(n){var r,e,t=i(this);return s(n)?!1:s(t)?!1:(e=Array.prototype.slice.call(arguments,1),r=a(n,e,t),r===!1?!1:(d(b.top,r,t),!0))}function o(n,r){var e=i(this);return y(n,r,e)?!1:(E[e]=E[e]||{},E[e][n]=E[e][n]||[],E[e][n].push(r),!0)}function u(n,r){var e,t,o=i(this);if(y(n,r,o))return!1;if(t=E[o]&&E[o][n],!t)return!1;for(e=0;e<t.length;e++)if(t[e]===r)return t.splice(e,1),!0;return!1}function i(n){return n&&n._origin||"*"}function s(n){return"string"!=typeof n}function a(n,r,e){var t=!1,o={event:n,origin:e},u=r[r.length-1];"function"==typeof u&&(o.reply=v(u,e),r=r.slice(0,-1)),o.args=r;try{t=M+JSON.stringify(o)}catch(i){throw new Error("Could not stringify event: "+i.message)}return t}function c(n){var r,e,t,o;if(n.data.slice(0,M.length)!==M)return!1;try{r=JSON.parse(n.data.slice(M.length))}catch(u){return!1}return null!=r.reply&&(e=n.origin,t=n.source,o=r.reply,r.reply=function(n){var r=a(o,[n],e);return r===!1?!1:(t.postMessage(r,e),void 0)},r.args.push(r.reply)),r}function f(r){b||(b=r||n,b.addEventListener?b.addEventListener("message",p,!1):b.attachEvent?b.attachEvent("onmessage",p):null===b.onmessage?b.onmessage=p:b=null)}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var r=16*Math.random()|0,e="x"===n?r:3&r|8;return e.toString(16)})}function p(n){var r;s(n.data)||(r=c(n),r&&(g("*",r.event,r.args,n),g(n.origin,r.event,r.args,n),h(n.data,r.origin,n.source)))}function g(n,r,e,t){var o;if(E[n]&&E[n][r])for(o=0;o<E[n][r].length;o++)E[n][r][o].apply(t,e)}function x(n){return n.top!==n?!1:null==n.opener?!1:n.opener===n?!1:n.opener.closed===!0?!1:!0}function d(n,r,e){var t;try{for(n.postMessage(r,e),x(n)&&d(n.opener.top,r,e),t=0;t<n.frames.length;t++)d(n.frames[t],r,e)}catch(o){}}function h(n,r,e){var t,o;for(t=w.length-1;t>=0;t--)o=w[t],o.closed===!0?w=w.slice(t,1):e!==o&&d(o.top,n,r)}function v(n,r){function e(o,u){n(o,u),m.target(r).unsubscribe(t,e)}var t=l();return m.target(r).subscribe(t,e),t}function y(n,r,e){return s(n)?!0:"function"!=typeof r?!0:s(e)?!0:!1}var b,m,w=[],E={},M="/*framebus*/";return f(),m={target:e,include:r,publish:t,pub:t,trigger:t,emit:t,subscribe:o,sub:o,on:o,unsubscribe:u,unsub:u,off:u}});